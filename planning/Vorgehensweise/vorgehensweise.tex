%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[
11pt, % Main document font size
a4paper, % Paper type, use 'letterpaper' for US Letter paper
oneside, % One page layout (no page indentation)
%twoside, % Two page layout (page indentation for binding and different headers)
pdfspacing, % Makes use of pdftex’ letter spacing capabilities via the microtype package
headinclude,
%footinclude, % Extra spacing for the header and footer
BCOR5mm, % Binding correction
ngerman, %set document to German
bibtotocnumbered,
]{scrartcl}
%{scrartcl}

\input{structure.tex} % Include the structure.tex file which specified the document structure and layout
%----------------------------------------------------------------------------------------
%	TITLE AND AUTHOR(S)
%----------------------------------------------------------------------------------------
\selectlanguage{ngerman}

\subtitle{\normalfont{Fachpraktikum 1597 an der FernUni Hagen im SS 2017:\protect\\Parallele Programmierung }}

\title{\normalfont{Vorgehensweise zur Erkennung von möglichen Notlandefeldern aus Höhendaten}} % The article title
%\title{\normalfont\spacedallcaps{Asnychrone Programmierung: \protect\\ Moderne Methoden in ECMAScript~6}} % The article title



\author{Felix Eckstein*, Dr. Björn Wittlich**} % The article author(s) 

\date{Juni 2017} % An optional date to appear under the author(s)

%----------------------------------------------------------------------------------------

\begin{document}
	
	\maketitle % Print the title/author/date block

	
	{\let\thefootnote\relax\footnotetext{* \textit{Student im Bachelor of Science Informatik an der FernUniversität Hagen,\protect\\Matr.-\#: 8161569, \href{mailto:felix.eckstein@gmx.de}{felix.eckstein@gmx.de}}}}
	{\let\thefootnote\relax\footnotetext{** \textit{Student im xxx xxxxx Informatik an der FernUniversität Hagen,\protect\\Matr.-\#: xxx xxxx, \href{mailto:BjoernWittich@gmx.de}{BjoernWittich@gmx.de}}}}
	
	\selectlanguage{ngerman}

\section{Vorgehensweise zur Erkennung von möglichen Notlandefeldern aus Höhendaten}

	\subsection{Grundsätzliche Überlegungen}
	
	
	\subsection{Kriterien für geeignete Notlandeflächen}
	
	Zunächst muss definiert werden, was eine geeignete Landefläche ausmacht, und wie sie charakterisiert werden kann. Es ist sofort einsichtig, dass eine Landebahn auf einer ausreichend großen Fläche glatt und eben sein muss. Die Fläche wird durch eine Mindestlänge und eine Mindestbreite charakterisiert. Daraus ergibt sich auch direkt eine Richtung. Als globale Parameter einer Landebahn sind also folgende Daten festzuhalten:
	\begin{itemize}
		\item Richtung der Bahn
		\item Breite
		\item Länge
	\end{itemize}

	Das Kriterium "`glatt und eben"' muss weiter spezifiziert werden. Dazu bieten sich Steigungskriterien an:
	
	\paragraph{Charakterisierung durch Steigungsdaten}
	Eine Landebahn kann durch einen Satz von Steigungsdaten charakterisiert werden:
	\begin{itemize}
		\item "`global"': Eine Landebahn darf auf Ihrer gesamten Länge nicht über ein gewisses Maß hinaus ansteigen. Ein Flugzeug kann nicht bergauf und auch nicht bergab landen. Es muss also für die gesamte minimale Bahnlänge ein maximaler Anstieg und ein maximaler Abfall gegeben werden.
		\item "`lokal"': Für (deutlich) kürzere Strecken als die Gesamtbahnlänge ist ein anderer Satz von maximalen/minimalen Steigungslimits notwendig, welche die maximale "`Holperigkeit"' der potentiellen Bahn beschreiben.
		\item "`Querneigung"': Eine optimale Landebahn ist senkrecht zur langen Achse perfekt eben. Eine reale Bahn darf geneigt bzw. in sich "`verwunden"' sein, solange kein kritischer Grenzwert für diese Querneigung überschritten wird. Diese maximale Querneigung wird über die Mindestbreite der Bahn angegeben.
		\item "`Verwindung"': Die Änderung der Querneigung darf sicherlich ein bestimmtes Limit nicht überschreiten. Es sollte also nicht die maximale "`Linksneigung"' direkt auf die maximale "`Rechtsneigung"' folgen.
	\end{itemize}

	Das globale Limit der Steigung ist sicherlich geringer als das lokale Limit für die Holprigkeit. (Extremfall: Landen auf Kopfsteinpflaster kann lokal ziemlich große Steigungen verursachen, wenn das Raster klein genug ist, stellt aber eigentlich kein Problem dar, da die Strecken zwischen den Rasterpunkten kurz genug sind.)
	
	\skippingparagraph
	\fbox{\begin{minipage}{\textwidth}
			{\bfseries\textsf{notwendige Eingabedaten:}}
			
			Um aus den Höhendaten geeignete Landebahnen zu ermitteln bekommt der zu beschreibende Algorithmus folgende Eingabedaten:
			\begin{itemize}
				\item minimale Bahnlänge in Metern
				\item Breite der Bahn in Metern
				\item Richtung der Bahn in Grad
				\item "`Holprigkeitslimit"': maximale Steigung im kurzen Bereich. Angegeben durch Höhendifferenz und Länge jeweils in Metern.
				\item "`Gesamtsteigung"': maximaler Anstieg und maximaler Abfall über die angegebene minimale Bahnlänge in Metern
				\item "`Querneigung"': maximale Querneigung der Bahn. Angegeben durch Höhendifferenz in Metern über der gewünschten Bahnbreite.
				\item "`Verwindung"': Die maximale Änderungsrate der Querneigung angegeben in Prozent über Länge in Hauptrichtung.
			\end{itemize}
	\end{minipage}}


	\paragraph{Offene Punkte:} 
	\begin{itemize}
		\item Muss die Holprigkeit in Querrichtung vollständig geprüft werden, oder reicht es aus die maximale Querneigung über die (relativ kurze) Bahnbreite zu betrachten?
		\item Sind verschiedenen Holprigkeitslimits in Längs und in Querrichtung notwendig?\\
		\item Ist es notwendig "`Zwischenlängen"' passend zu ergänzen? Z. B. indem eine kürzere Länge so lange verdoppelt wird, bis sich die nächst längere Länge ergibt. Dann müsste ein "`gewichteter"' Mittelwert der erlaubten maximalen Steigungen angegeben werden, damit eine Gesamtsteigung mit einem überlagerten "`Holpern"' noch OK ist. 
	\end{itemize}
	Diese offenen Punkte werden in der Erprobung sicherlich klar werden.


\section{Datenbasis}

Die Höhedaten liegen in Form eines GeoTIFF vor. Dabei handelt es sich um ein Rasterformat, bei dem jedem Rasterpunkt bestimmte Geodaten zugeordnet werden. Diese Daten werden in dem Grafikformat anstelle der ansonsten enthaltenen Farbwerte gespeichert und müssen entsprechend ihrer Bedeutung interpretiert werden. Prinzipiell ist es möglich mehrere Werte pro Rasterpunkt zu speichern. In unserem Fall ist für jeden Rasterpunkt die Höhe über normal Null in Metern angegeben. Dieser Wert liegt als einfach genaue 32bit Gleitkommazahl vor.

Die Kodierung und Komprimierung der Werte wird das bekannte TIFF Format eingesetzt, das insbesondere auch die verlustlose Speicherung und Komprimierung unterstützt.

Zusätzlich gehört zu dem in eine TIFF-Datei eingebetteten Nutzdatensatz gehören zu einem GeoTIFF noch Angaben über Auflösung und Projektion des Datensatzes. Damit wird es möglich jedes Pixel des GeoTIFF eindeutig einem Punkt auf der Erdoberfläche in den üblichen Koordinaten aus geographischer Länge und Breite zuzuordnen.

Für die ersten Experimente und die Validierung des Verfahrens wird ein Höhendatensatz von Nordrheinwestfalen verwendet. Dieser ist verfügbar unter \href{http://data.opendataportal.at/dataset/dtm-germany/resource/08d8c183-a4cc-4a7b-84a0-d03f92076ed3}{DTM Germany\textunderscore Nordrhein-Westfalen, 20m}


	\subsection{Auflösung}
	Ob der zu entwickelnde Algorithmus zum Auffinden von möglichen Notlandefeldern in der Praxis tauglich ist hängt wesentlich von der Qualität und Auflösung der Eingabedaten ab. Der vorliegende Datensatz hat eine horizontale Auflösung von 20m und eine vertikale Auflösung von 0.1m. 
	
	Intuitiv wird eine 20m Auflösung für die Bestimmung der Holprigkeit einer Bahn zu grob sein. 
	
	Es ist angekündigt, dass im weiteren Verlauf dieses Praktikums ein deutlich höher aufgelöster Datensatz zur Verfügung gestellt werden kann. Dies ist bei der Auslegung der Algorithmen und Berechnungsmethoden von Anfang an einzuplanen. Dabei ist zu beachten, dass die Datenmenge quadratisch mit der Auflösung wächst. Ein mit 1m horizontal aufgelöster Datensatz ist also schon 400 Mal so groß wie der vorliegende Testdatensatz.
	
	\subsection{Dateneinlesung}
	Für das Einlesen der Daten kann auf bewährte OpenSource Tools zurückgegriffen werden. Diese müssen für den speziellen Einsatzzweck angepasst, aber nicht von Grund auf neu entwickelt werden.
	
	Die Einlesung der Rasterdaten kann mit einer angepassten Version von \href{https://www.imnc.in2p3.fr/pagesperso/deroulers/software/largetifftools/tifffastcrop.html} erfolgen\footnote{
	Details dazu siehe: Deroulers et al., \href{https://www.imnc.in2p3.fr/pagesperso/deroulers/software/ndpitools/article_diagnostic_pathology.pdf}{Analyzing huge pathology images with open source software}, \href{http://www.diagnosticpathology.org/content/8/1/92}{Diagnostic Pathology 8:92 (2013)}}. 
	Dies hat im Prototypen problemlos funktioniert.
	
	Bei der Einlesung ist darauf zu achten, dass ein effizientes Verfahren zur Einlesung von Kacheln notwendig ist, da bei höher aufgelösten Daten nicht mehr davon ausgegangen werden kann, dass alle Daten auf einmal im RAM gehalten werden können.
	
	Zur Umrechnung der Pixelkoordinaten in geographische Koordinaten und zur Ermittlung der Metadaten des GeoTIFF Datensatzes kann auf \href{https://trac.osgeo.org/geotiff/}{libgeotiff} zurückgegriffen werden.
	
	\skippingparagraph
	\fbox{\begin{minipage}{\textwidth}
			{\bfseries\textsf{Einlesen der Eingabedaten:}}
			
			Als Anforderung an die Einlesung der Eingabedaten ergibt sich:
			\begin{itemize}
				\item Es müssen nacheinander Kacheln mit Rücksicht auf vorhandenen Speicherausbau eingelesen werden können
				\item Die Metadaten (Auflösung des Datensatzes, Ausdehung der Daten) muss bereit gestellt werden
				\item Routinen zur Umrechnung von/in Pixelkoordinaten von/in geographische Koordinaten müssen bereit gestellt werden.
			\end{itemize}
	\end{minipage}}
	\skippingparagraph	%Offensichtlich muss nach der Minipage noch etwas kommen, sonst kommt TeXStudio mit der Struktur durcheinander.
	
	

\section{Durchmusterung}

Die zentrale Funktion zum Auffinden von Notlandebahnen ist eine systematische Durchmusterung der eingelesenen Daten. Obwohl diese Funktion im Grundsatz sehr trivial scheint, so ergeben sich doch einige beachtenswerte Details, die nachfolgend angegeben werden sollen.

\subsection{Einfache Durchmusterung}
Eine Landebahn kann auf jedem beliebigen Rasterpunkt der Höhendaten beginnen. Von einem Startpunkt ausgehend muss in einer geraden Richtung ein Bereich existieren, in dem keines der angegebenen Kriterien verletzt wird. 

Eine geeignete Landebahn ist gefunden, wenn ein rechteckiger Bereich gefunden ist, bei dem für jeden Rasterpunkt innerhalb der minimalen geforderten Länge und Breite die gegebenen Steigungslimits nicht überschritten werden.
Auch wenn die kürzeste Vorausschaulänge länger ist als der Abstand der Rasterpunkte, so muss die Überprüfung der Steigungslimits doch für jeden Rasterpunkt innerhalb der Bahn erfolgen und entsprechend positiv ausfallen.

Der Algorithmus zur Durchmusterung eines Datensatzes muss also von jedem vorhandenen Rasterpunkt in vorgegebener Richtung die Kriterien abtesten und festhalten, ob ein bestimmter Punkt als Startpunkt einer Landebahn in Frage kommt.

Eine Kachel wird so groß gewählt, dass sie vollständig in den Speicher passt und zusätzlich Platz ist, für die einzelnen Punkte alle notwendigen Verwaltungs- und Ergebnisinformationen zu speichern.

Eine Kachel wird in jedem Durchgang auf Bahnen in einer vorgegebenen Richtung durchmustert. Diese Richtung gibt die Längsachse der potentiellen Bahn an.

Die Steigungsüberprüfung erfolgt immer vorwärts gerichtet und berechnet den Quotienten aus Höhenänderung über Vorausschaulänge. Es wird also überprüft, ob vom aktuellen Punkt aus vorwärts kein Hindernis eine Landung unmöglich macht.

	\skippingparagraph
	\fbox{\begin{minipage}{\textwidth}
		{\bfseries\textsf{Brute Force:}}
		\begin{itemize}
			\item Berechne für einen Punkt die Steigungsmaße für die vorgegebenen Vorausschaulängen und speichere sie pro Punkt.
			\begin{itemize}
				\item Gesamtsteigung
				\item Holprigkeit
				\item Querneigung
				\item Verwindung
			\end{itemize}
			\item Wenn ein Limit gerissen wurde, dann markiere das entsprechend.
			\item Gehe zum nächsten Punkt.
		\end{itemize}
	
		Alle Punkte, die sämtliche Steigungstests bestehen sind Kandidatenpunkte für den Beginn einer Landebahn.
		\begin{itemize}
			\item Fasse die Kandidatenpunkte entlang der durchmusterten Bahn in möglichst lange Teilstrecken zusammen.
			\item Streiche alle Teilstrecken kürzer als die Mindestbahnlänge
		\end{itemize}
	
		Beachte: Ein Punkt kann durchaus innerhalb einer Landebahn liegen, auch wenn er nicht Startpunkt einer Bahn sein kann. Jedes Kriterium hat eine eigene Vorausschaulänge. Ein Punkt muss nur dann endgültig ausgeschlossen werden, wenn die Kriterien gerissen wurden, deren Vorausschaulänge vollständig innerhalb der potentiellen Landebahn liegt.
	\end{minipage}
}

	\skippingparagraph	%Offensichtlich muss nach der Minipage noch etwas kommen, sonst kommt TeXStudio mit der Struktur durcheinander.
 

\subsection{Berücksichtigung unterschiedlicher Rasterweiten}

	Die Durchmusterung muss mit allen möglichen Rasterweiten zurechtkommen. Der Durchmusterungsalgorithmus muss also so programmiert werden, dass die Rasterweite keine Rolle spielt. Der Algorithmus soll auch in der Lage sein, in horizontaler und in vertikaler Richtung mit unterschiedlichen Rasterweiten zurechtzukommen. Die Rasterweiten (in Metern) müssen von der Dateneinleseroutine in X- und Y-Richtung bereitgestellt werden.

	Dazu sind folgende Überlegungen anzustellen:
	
 	\begin{minipage}{\textwidth}
 		\skippingparagraph
 		
		\begin{minipage}[t]{\textwidth-4cm}
			\vspace{0pt}
			Bei rechteckigen Rastern stimmt die Rasterrichtung nur in Ausnahmefällen mit der Durchmusterungsrichtung überein. Um sicher zu sein, dass die Landebahn an jeder Stelle die benötigten Kriterien erfüllt muss jedes Rasterpixel untersucht werden, das vom Durchmusterungsstrahl berührt wird. Ausgehend von einem Pixel wird der Strahl in die gewünschte Richtung über das Rater geworfen und jedes Pixel, das berührt wird muss als Prüfpunkt benutzt werden.
			
			Analog müssen die Pixel senkrecht zur gewählten Durchmusterungsrichtung ausgewählt werden.
			
			In der nebenstehenden Grafik ist dies grafisch verdeutlicht.
		\end{minipage}
		\begin{minipage}[t]{3cm}
			\vspace{0pt}
			\centering
			\includegraphics{./drawings/Durchmusterungspfad.png}
		\end{minipage}
	\skippingparagraph
	\end{minipage}
	
	
	
	Das Holprigkeitskriterium hat die kürzeste Vorausschaulänge. Es sind zwei Fälle zu unterscheiden: 
	
	Entweder ist die Vorausschaulänge kürzer als der Abstand zweier Pixel, oder die Vorausschaulänge ist mindestens so lang wie der aktuelle Pixelabstand.
	
	Bei Pixelabständen, die größer sind als die aktuelle Vorausschaulänge muss die Vorausschaulänge künstlich auf den Pixelabstand in Durchmusterungsrichtung erhöht werden. Die zugehörige Höhendifferenz muss entsprechend skaliert werden. 
	
	 	\begin{minipage}{\textwidth}
		\skippingparagraph
		
		\begin{minipage}[t]{3cm}
			\vspace{0pt}
			\centering
			\includegraphics[width=3cm]{./drawings/Vorausschaulaengen.png}
		\end{minipage}
			\begin{minipage}[t]{\textwidth-3cm}
				\vspace{0pt}
				Bei Pixelabständen, die kleiner oder gleich sind wie die aktuelle Vorausschaulänge wird die die Steigung aus der Höhendifferenz zweischen Start- und der Zielpixel berechnet. Eine Skalierung muss nicht stattfinden. Es ist aber zu beachten, dass entlang des Durchmusterungspfades jedes Pixel als Startpunkt betrachtet werden muss.			
		\end{minipage}\skippingparagraph
	\end{minipage}

	Bei Vorausschaulängen, die kürzer sind als die aktuelle Rasterweite kann das vorgestellte Verfahren dazu führen, dass Hindernisse übersehen werden. Eine Interpolation innerhalb der Kacheln würde jedoch auch nichts nützen, da die Eingangsdaten einfach "`nicht mehr hergeben"'. Somit scheint das vorgeschlagene Vorgehen der beste Kompromiss zur Vorauswahl geeigneter Landeflächen zu sein. Bei ernsthafter Anwendung werden besser aufgelöste Daten benötigt.
	

\subsection{Optimierung}

Das vorgestellte Verfahren geht stumpf über jeden Punkt der Daten und versucht dann zusammenhängende geeignete Punkte zu erkennen. Bei den zu erwartenden großen (weil hochaufgelösten) Datensätzen sollten soviele Punkte wie möglich so früh wie möglich ausgeschlossen werden um den Rechenaufwand so gering wie möglich zu halten.

Idee zur Optimierung:

Um die Menge der (genau) zu überprüfenden Daten möglichst schnell zu minimieren, ist es wichtig, dass bei einem frühen (grob gerasterten) Durchlauf schon möglichst viele Punkte als Kandidaten herausfallen.

Wenn ein Punkt aus der KandidatenMenge herausfällt, dann wirft er einen „Schatten“ auf das zurückliegende Stück. Eine Bahn kann nicht geeignet sein, wenn sie innerhalb ihrer Mindestlänge diesen ungeeigneten Punkt zwangsläufig enthält.

\begin{itemize}
\item Wenn ein Punkt aufgrund eines Kriteriums herausfällt, dann kann die direkt vor ihm liegende Strecke auf keinen Fall Teil einer geeigneten Landebahn sein. 
Es können also alle Punkte vom Ende der zugehörigen Vorausschaulänge bis zur minimalen Bahnlänge vor diesem Ende der Vorausschaulänge für weitere Berechnungen ausgeschlossen werden. Die Strecke zwischen Punkt und Vorausschauende darf dabei \emph{nicht} ausgeschlossen werden. Dort könnte ja gerade eine neue Ebene beginnen!
\item Wenn also ein ungeeigneter Punkt gefunden wird, dann brauchen die Punkte, die innerhalb der Strecke vom aktuellen Punkt bis zur Mindestbahnlänge vor dem Vorausschauende liegen nicht mehr überprüft werden.
\item Bei einer kurzen Vorausschau können also besonders viele Punkte aufgrund einer einzelnen Steigungsverletzung ausgeschlossen werden. (Fange mit den kurzen Vorausschaulängen an zu durchmustern)
\item Die Schrittweite bei jedem Durchlauf sollte also der Mindestbahnlänge entsprechen. Wenn ein Punkt herausfällt, dann werden die davor liegenden Punkte aus der weiteren Durchmusterung ausgeschlossen.
\item In einem nächsten Durchlauf wird der nächste noch zu besuchende Punkt gewählt, aber die Schrittweite bleibt bei der minimalen Bahnlänge. Wenn auf einen Punkt getroffen wird, der in einem vorherigen Durchlauf ausgeschlossen wurde, fahre mit dem Punkt fort, der eine minimale Bahnlänge Abstand vom auszulassenden Bereich hat.
\item Wiederhole so lange, bis alle Punkte entlang einer Richtung entweder ausgeschlossen wurden, oder für das überprüfte Steigungskriterium als geeignet erscheinen.

\end{itemize}
Diese Optimierung bringt nur etwas, wenn die Vorausschaulänge kleiner als die minimale Landebahnlänge ist. Bei einem wirklich „globalen“ Kriterium (Maximalanstieg auf der gesamten Bahnlänge) muss also trotzdem jeder Punkt durchmustert werden.


\subsection{Kachelränder}

\subsection{Datenstrukturen während der Durchmusterung}

\section{Datenhaltung gefundener Notlandeflächen}

\section{Benutzung und Visualisierung}

\section{Parallelisierung}

\end{document}